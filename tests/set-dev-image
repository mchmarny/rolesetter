#!/usr/bin/env bash
set -euo pipefail

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT="$(cd "$DIR/.." && pwd)"

# Assume current k8s context
IMAGE=$1
PATCH_FILE=${2:-"${ROOT}/deployment/overlays/dev/patch-deployment.yaml"}

if [[ -z "$IMAGE" ]]; then
  echo "Usage: $0 <image>"
  exit 1
fi

# Update the image line using sed (matches any line containing 'image:')
sed -i '' "s|image: .*|image: $IMAGE|" "$PATCH_FILE"

echo "Setting image in $PATCH_FILE to $IMAGE"


