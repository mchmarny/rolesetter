apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: rolesetter-slsa-v02
spec:
  mode: enforce
  images:
    - glob: ghcr.io/mchmarny/node-role-controller*
  authorities:
    - keyless:
        url: https://fulcio.sigstore.dev
        identities:
          - issuer: https://token.actions.githubusercontent.com
            subjectRegExp: ^https://github\.com/slsa-framework/slsa-github-generator/\.github/workflows/generator_container_slsa3\.yml@refs/tags/v[0-9]+\.[0-9]+\.[0-9]+$
      ctlog:
        url: https://rekor.sigstore.dev
      attestations:
        - name: slsa-provenance
          predicateType: https://slsa.dev/provenance/v0.2
          policy:
            type: cue
            data: |
              predicateType: "https://slsa.dev/provenance/v0.2"
              predicate: {
                builder: {
                  id: =~"^https://github\\.com/slsa-framework/slsa-github-generator/\\.github/workflows/generator_container_slsa3\\.yml@refs/tags/v[0-9]+\\.[0-9]+\\.[0-9]+$"
                }
                invocation: {
                  configSource: {
                    entryPoint: ".github/workflows/on-tag.yaml"
                    uri: =~"^git\\+https://github\\.com/mchmarny/rolesetter@refs/tags/v[0-9]+\\.[0-9]+\\.[0-9]+$"
                  }
                }
              }